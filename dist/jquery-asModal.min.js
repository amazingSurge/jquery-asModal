/*! jQuery asModal - v0.2.1 - 2014-09-06
* https://github.com/amazingSurge/jquery-asModal
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d){"use strict";var e=function(){var a,c=b.createElement("fakeelement"),e={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"},f=!1;for(var g in e)e.hasOwnProperty(g)&&c.style[g]!==d&&(a=e[g]);return a&&(f=!0),{css3Support:f,animationEnd:a}}(),f=c.modal=function(a,b){this.element=a,this.$element=c(a),this.$container=c("<div></div>"),this.$contentWrap=c("<div></div>").appendTo(this.$container),this.$content=c("<div></div>").appendTo(this.$contentWrap);var d=[];c.each(this.$element.data(),function(a,b){var c=new RegExp("^modal","i");c.test(a)&&(d[a.toLowerCase().replace(c,"")]=b)}),this.options=c.extend(!0,{},f.defaults,b,d),this.namespace=this.options.namespace,this.css3Support=e.css3Support,this.animationEnd=e.animationEnd,this.css3Support||(this.options.effect=this.options.effectFallback),this.classes={overlay:this.namespace+"-overlay",container:this.namespace+"-container",content:this.namespace+"-content",contentWrap:this.namespace+"-contentWrap",skin:this.namespace+"_"+this.options.skin,error:this.namespace+"_error",open:this.namespace+"_open",animateActive:this.namespace+"_animateActive",effect:this.namespace+"_"+this.options.effect,overlayEffect:this.namespace+"_ovrelay_"+this.options.effect,loading:this.namespace+"_loading",disabled:this.namespace+"_disabled"},this.options.skin&&(this.$element.addClass(this.classes.skin),this.$container.addClass(this.classes.skin)),this.$container.addClass(this.classes.container),this.$contentWrap.addClass(this.classes.contentWrap),this.$content.addClass(this.classes.content),this.options.overlay&&(this.$overlay=c("<div></div>"),this.$overlay.addClass(this.classes.overlay),this.options.skin&&this.$overlay.addClass(this.classes.skin)),this.isLoading=!1,this.disabled=!1,this.isError=!1,this.isOpen=!1,this.init()};f.prototype={constructor:f,init:function(){var a=this;null===this.options.content&&(this.options.content=this.$element.attr("href")),this.$contentWrap.addClass(this.classes.effect),this.$overlay.addClass(this.classes.overlayEffect),this.$container.appendTo("body"),this.$overlay.appendTo("body"),this.options.width&&this.$content.width(this.options.width),this.options.height&&this.$content.height(this.options.height),this.options.closeElement&&this.$contentWrap.on("click.modal",this.options.closeElement,c.proxy(this.hide,this)),this.$element.on("click.modal",function(){return a.disabled||a.open(),!1}),this.options.closeByOverlayClick&&this.$container.on("click.modal",function(b){return c(b.target).hasClass(a.classes.container)?(a.close(),!1):void 0})},_load:function(){var a=this,b=c.Deferred();return"#"===this.options.content.charAt(0)||"."===this.options.content.charAt(0)?b.resolve(c(this.options.content)):(this._showLoading(),c.ajax({type:"get",cache:!0,url:this.options.content}).then(function(a){b.resolve(c(a))},function(){b.reject(a.options.errorContent)})),b.promise()},_unbindeEvent:function(){c(b).off("keydown.modal")},_showLoading:function(){this.$loading=c("<div></div>").html(this.options.loadingContent).addClass(this.classes.loading),this.$loading.appendTo(this.$overlay)},_hideLoading:function(){this.$loading&&(this.$loading.remove(),this.$loading=null)},_animate:function(){var a=c.Deferred();return this.css3Support?a.reject():f.animations[this.options.effectFallback][this.status](this,a),a.promise()},open:function(){var a=this;return this.isLoading&&this._hideLoading(),this.options.overlay&&(this.$overlay.addClass(this.classes.open),this.$overlay.animate({opacity:1},{duration:this.options.overlaySpeed})),this.options.closeByEscape&&c(b).on("keydown.modal",function(b){27===b.keyCode&&a.close()}),this.content&&!this.isError?void this._afterOpen():(this.$content.removeClass(this.classes.error),void this._load().always(function(){a._hideLoading()}).then(function(b){a.content=b,a.$content.empty().html(a.content),a._afterOpen()},function(b){a.$content.addClass(a.classes.error),a.isError=!0,a.content=b,a.$content.empty().html(a.content),a._afterOpen()}))},_afterOpen:function(){var a=this;this.options.focus&&setTimeout(function(){var b=c.isFunction(a.content.find)&&a.content.find("input");b.length>0&&b.get(0).focus()},10),this.$container.addClass(this.classes.open),setTimeout(function(){a.$contentWrap.addClass(a.classes.animateActive)},0),this.status="moveIn",this._animate().then(function(){a.isOpen=!0,a.$content.trigger(a.animationEnd,a)})},close:function(){var a=this;this.status="moveOut",this.$content.on(this.animationEnd,function(){return a._afterClose(),a.$content.off(a.animationEnd),"function"==typeof a.options.onComplete&&a.options.onComplete.call(this,this),a.$container.trigger("modal::complete",this),!1}),this.$overlay.animate({opacity:0},{duration:this.options.overlaySpeed,complete:function(){a.$overlay.removeClass(a.classes.open)}}),this.$contentWrap.removeClass(this.classes.animateActive),this._animate().then(function(){a._afterClose()})},_afterClose:function(){this._unbindeEvent(),this.$container.removeClass(this.classes.open),this.isOpen=!1},enable:function(){this.disabled=!1,this.$element.addClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$element.removeClass(this.classes.disabled)},destroy:function(){this.$element.off("click.modal"),this.$container.remove(),this.$overlay.remove()}},f.animations={fade:{moveIn:function(a,b){a.$content.animate({opacity:1},{duration:400,complete:function(){b.resolve()}})},moveOut:function(a,b){a.$content.animate({opacity:0},{duration:400,complete:function(){b.resolve()}})}}},f.defaults={namespace:"modal",skin:null,content:null,overlay:!0,closeElement:null,effect:"fadeScale",overlaySpeed:200,effectFallback:"fade",focus:!0,errorContent:"sorry, ajax error.",loadingContent:"loading...",closeByEscape:!0,closeByOverlayClick:!0,width:null,hieght:null,onOpen:null,onClose:null},c.fn.asModal=function(a){if("string"==typeof a){var b=a,d=Array.prototype.slice.call(arguments,1);return/^\_/.test(b)?!1:this.each(function(){var a=c.data(this,"asModal");a&&"function"==typeof a[b]&&a[b].apply(a,d)})}return this.each(function(){c.data(this,"asModal")||c.data(this,"asModal",new f(this,a))})}}(window,document,jQuery);