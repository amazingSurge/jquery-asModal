/*! jQuery Modal - v0.2.1 - 2013-11-22
* https://github.com/amazingSurge/jquery-modal
* Copyright (c) 2013 amazingSurge; Licensed GPL */
(function(t,n,e,s){var i=function(){var t,e=n.createElement("fakeelement"),i={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"},o=!1;for(var a in i)i.hasOwnProperty(a)&&e.style[a]!==s&&(t=i[a]);return t&&(o=!0),{css3Support:o,animationEnd:t}}(),o=e.modal=function(t,n){this.element=t,this.$element=e(t),this.$overlay=e("<div></div>").css({display:"none"}),this.$container=e("<div></div>").css({display:"none"}),this.$contentWrap=e("<div></div>").appendTo(this.$container),this.$content=e("<div></div>").appendTo(this.$contentWrap);var s=[];e.each(this.$element.data(),function(t,n){var e=RegExp("^modal","i");e.test(t)&&(s[t.toLowerCase().replace(e,"")]=n)}),this.options=e.extend(!0,{},o.defaults,n,s),this.namespace=this.options.namespace,this.css3Support=i.css3Support,this.animationEnd=i.animationEnd,this.css3Support||(this.options.effect=this.options.effectFallback),this.classes={overlay:this.namespace+"-overlay",container:this.namespace+"-container",content:this.namespace+"-content",contentWrap:this.namespace+"-contentWrap",skin:this.namespace+"_"+this.options.skin,error:this.namespace+"_"+"error",open:this.namespace+"_"+"open",effect:this.namespace+"_"+this.options.effect,overlayEffect:this.namespace+"_ovrelay_"+this.options.effect,loading:this.namespace+"_loading"},null!==this.options.skin&&(this.$element.addClass(this.classes.skin),this.$container.addClass(this.classes.skin),this.$overlay.addClass(this.classes.skin)),this.$container.addClass(this.classes.container),this.$overlay.addClass(this.classes.overlay),this.$contentWrap.addClass(this.classes.contentWrap),this.$content.addClass(this.classes.content),this.isLoading=!1,this.enabled=!0,this.isError=!1,this.isOpen=!1,this.init()};o.prototype={constructor:o,init:function(){var t=this;null===this.options.content&&(this.options.content=this.$element.attr("href")),this.$contentWrap.addClass(this.classes.effect),this.$overlay.addClass(this.classes.overlayEffect),this.$container.appendTo("body"),this.$overlay.appendTo("body"),this.options.width&&this.$content.width(this.options.width),this.options.height&&this.$content.height(this.options.height),this.$element.on("click.modal",function(){return t.enabled&&t.open(),!1}),this.options.closeByOverlayClick&&this.$container.on("click.modal",function(n){return e(n.target).hasClass(t.classes.container)?(t.close(),!1):s})},_load:function(){var t=this,n=e.Deferred();return"#"===this.options.content.charAt(0)||"."===this.options.content.charAt(0)?n.resolve(e(this.options.content)):(this._showLoading(),e.ajax({type:"get",cache:!0,url:this.options.content}).then(function(t){n.resolve(e(t))},function(){n.reject(t.options.errorContent)})),n.promise()},_unbindeEvent:function(){this.options.closeElement&&this.$close.off("click.modal"),e(n).off("keydown.modal")},_showLoading:function(){this.$loading=e("<div></div>").html(this.options.loadingContent).addClass(this.classes.loading),this.$loading.appendTo(this.$overlay)},_hideLoading:function(){this.$loading&&(this.$loading.remove(),this.$loading=null)},_animate:function(){var t=e.Deferred();return this.css3Support?t.reject():o.animations[this.options.effectFallback][this.status](this,t),t.promise()},open:function(){var t=this;return this.isLoading&&this._hideLoading(),this.options.overlay&&this.$overlay.css({display:"block",opacity:0}),this.options.closeByEscape&&e(n).on("keydown.modal",function(n){27===n.keyCode&&t.close()}),this.$overlay.animate({opacity:1},{duration:this.options.overlaySpeed}),this.content&&!this.isError?(this._afterOpen(),s):(this.$content.removeClass(this.classes.error),this._load().always(function(){t._hideLoading()}).then(function(n){t.content=n,t.$content.empty().html(t.content),t._afterOpen()},function(n){t.$content.addClass(t.classes.error),t.isError=!0,t.content=n,t.$content.empty().html(t.content),t._afterOpen()}),s)},_afterOpen:function(){var t=this;this.options.closeElement&&(this.$close=this.content.find(this.options.closeElement),this.$close.on("click.modal",e.proxy(this.hide,this))),this.options.focus&&setTimeout(function(){var n=e.isFunction(t.content.find)&&t.content.find("input");n.length>0&&n.get(0).focus()},60),this.$container.css({display:"block"}),setTimeout(function(){t.$contentWrap.addClass(t.classes.open),t.$overlay.addClass(t.classes.open)},0),this.status="moveIn",this._animate().then(function(){t.isOpen=!0,t.$content.trigger(t.animationEnd,t)})},close:function(){var t=this;this.status="moveOut",this.$content.on(this.animationEnd,function(){return t._afterClose(),t.$content.off(t.animationEnd),"function"==typeof t.options.onComplete&&t.options.onComplete.call(this,this),t.$container.trigger("modal::onComplete",this),!1}),this.$overlay.animate({opacity:0},{duration:this.options.overlaySpeed,complete:function(){t.$overlay.css({display:"none"})}}),this.$contentWrap.removeClass(this.classes.open),this._animate().then(function(){t._afterClose()})},_afterClose:function(){this._unbindeEvent(),this.$container.removeClass(this.classes.open).css({display:"none"}),this.isOpen=!1},enable:function(){this.enabled=!0,this.$element.addClass(this.classes.enabled)},disable:function(){this.enabled=!1,this.$element.removeClass(this.classes.enabled)},destroy:function(){this.$element.off("click.modal"),this.$container.remove(),this.$overlay.remove()}},o.animations={fade:{moveIn:function(t,n){t.$content.animate({opacity:1},{duration:400,complete:function(){n.resolve()}})},moveOut:function(t,n){t.$content.animate({opacity:0},{duration:400,complete:function(){n.resolve()}})}}},o.defaults={namespace:"modal",skin:null,content:null,overlay:!0,closeElement:null,effect:"fadeScale",overlaySpeed:200,effectFallback:"fade",focus:!0,errorContent:"sorry, cant find the file !",loadingContent:"loading...",closeByEscape:!0,closeByOverlayClick:!0,width:null,hieght:null,onOpen:null,onClose:null},e.fn.modal=function(t){if("string"==typeof t){var n=t,i=arguments.length>1?Array.prototype.slice.call(arguments,1):s;return this.each(function(){var t=e.data(this,"modal");"function"==typeof t[n]&&t[n].apply(t,i)})}return this.each(function(){e.data(this,"modal")||e.data(this,"modal",new o(this,t))})}})(window,document,jQuery);